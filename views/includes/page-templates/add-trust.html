{% macro trustStatus(trust) %}
  {% if trust.ceased_date_day and trust.ceased_date_month and trust.ceased_date_year %}
    Removed
  {% else %}
    Active
  {% endif %}
{% endmacro %}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      {% include "includes/list/errors.html" %}
      <h1 class="govuk-heading-xl govuk-!-margin-10">{{ title }}</h1>

      {% if pageData.trustData.length > 0 %}
        {% set reviewedTrustsRows = [] %}
        {% set addedTrusts = [] %}
        {% for trust in pageData.trustData %}
            {% if trust.ch_reference.length %}
              {% set reviewedTrustsRows = (reviewedTrustsRows.push({
                key: {
                  text: trust.trust_name
                },
                value: {
                  text: trustStatus(trust) if isFeatureFlagCeaseTrustsEnabled
                },
                actions: {
                  items: [CREATE_CHANGE_LINK(
                    OE_CONFIGS.UPDATE_MANAGE_TRUSTS_ORCHESTRATOR_CHANGE_HANDLER_URL + "/" + trust.trust_id,
                    "Trust " + trust.trust_name,
                    "change-trust-button"
                  )]
                }
              }), reviewedTrustsRows) %}
            {% else %}
              {% set addedTrusts = (addedTrusts.push(trust), addedTrusts) %}
            {% endif %}
        {% endfor %}
      {% endif %}

      {% if reviewedTrustsRows.length > 0 %}
      <div class="govuk-summary-card">
        <div class="govuk-summary-card__title-wrapper">
          <h2 class="govuk-summary-card__title"> What you have reviewed </h2>
        </div>
        <div class="govuk-summary-card__content">
          <dl class="govuk-summary-list">
        {{ govukSummaryList({ rows: reviewedTrustsRows }) }}
        </dl></div></div>
      {% endif %}

      {% if (isUpdate and addedTrusts.length > 0) %}
        <h3 class="govuk-heading-m">What you have added so far</h3>
      {% endif %}

      {% if isUpdate %}
        {% set changeLink = OE_CONFIGS.UPDATE_TRUSTS_TELL_US_ABOUT_IT_PAGE %}
      {% else %}
        {% if FEATURE_FLAG_ENABLE_REDIS_REMOVAL %}
          {% set changeLink = OE_CONFIGS.REGISTER_AN_OVERSEAS_ENTITY_URL + activeSubmissionBasePath + OE_CONFIGS.TRUSTS_URL %}
        {% else %}
          {% set changeLink = OE_CONFIGS.TRUST_DETAILS_URL %}
        {% endif %}
      {% endif %}

      {% for trust in addedTrusts %}
        {{ govukSummaryList({
        rows: [
          {
            key: {
              text: trust.trust_name
            },
            value: {
              text: trustStatus(trust) if isFeatureFlagCeaseTrustsEnabled
            },
            actions: {
              items: [ CREATE_CHANGE_LINK(
                changeLink + "/" + trust.trust_id + OE_CONFIGS.NAME,
                "Trust " + trust.trust_name,
                "change-trust-button"
                ) ]
              }
            }
          ]
        })
      }}
      {% endfor %}
      <form method="post">
        {% include "includes/csrf_token.html" %}

        <h2 class="govuk-heading-m"> Do you need to add another trust? </h2>
        <div class="govuk-inset-text">
          <p>Based on the pre-registration statement you provided earlier in this service, you also need to tell us about any beneficiaries from this period, that the entity has not already told us about.</p>
          {% include "includes/page-templates/relevant-period.html" %}
        </div>

        {% set fieldParam = {
          name: 'addTrust',
          error: errors.addTrust,
          items: [
            {
        value: 1,
        text: "Yes - for the current filing period",
        attributes: {
        "data-event-id": "add-trust-yes-radio-option"
        },
        checked: formData.addTrust == 1
        }, {
        value: preRegistrationPeriod,
        text: "Yes - for the pre-registration period",
        checked: formData.preRegistrationPeriod == 1
        },
        {
              value: 0,
              text: "No",
              attributes: {
                "data-event-id": "add-trust-no-radio-option"
              },
              checked: formData.addTrust == 0
            }
          ]
        } %}

        {% include "includes/inputs/radio-input.html" %}
        {% if isUpdate %}
          {% include "includes/save-and-continue-button.html" %}
        {% else %}
          {% include "includes/continue-button.html" %}
        {% endif %}
        </form>
      </div>
    </div>
  {% endblock %}
